<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="Culture and Social Cognitive Neuroscience Laboratory (CSCN Lab), School of Psychological and Cognitive Sciences, Peking University">
    <meta name="keywords" content="Culture, Social, Cognitive, Neuroscience">
    <title>Culture and Social Cognitive Neuroscience Laboratory (CSCN Lab)</title>
    <!-- Bootstrap -->
    <link href="css/lib/bootstrap.min.css" rel="stylesheet">
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="css/lib/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link rel="stylesheet" type="text/css" href="" />
    
    <script src="js/lib/ie-emulation-modes-warning.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="js/lib/html5shiv.min.js"></script>
      <script src="js/lib/respond.min.js"></script>
    <![endif]-->
<style>  
    #drawing {  
        width: 500px;  
        height: 500px;  
        border:1px solid;  
        position: relative;  
        overflow: hidden;  
    }  
  
    .circle {  
        border:1px solid #000;
        position: absolute;
        text-align: center;
        overflow: hidden;
    }  
</style>  

  </head>
  <body>
    <div class="container">
      <div class="head"><h2>这里是指导语，这里是指导语</h2></div>
      <div class="content">
        <p><input type="input" id="screen_size" name="screen_size" value="22"></p>
        <div class="sqr_block" style="width:278px; height:278px; border:2px solid #000;">
        	
        </div>
        <div id="drawing">  </div>
        <div id="div1">  </div>
      </div>
    </div> <!-- /container -->

    <div class="footer">
      <div class="container">
        <p class="text-muted">&copy; CSCN lab</p>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/lib/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/lib/bootstrap.min.js"></script>
    <script type="text/javascript">
(function($) {
        var old = $.fn.toLine;

        function ToLine(element, options) {
                this.ver = '1.0';
                this.$element = $(element);
                this.options = $.extend({}, $.fn.toLine.defaults, options);
                this.init();
        }

        ToLine.prototype = {
                constructor: ToLine,
                init: function() {
                        var options = this.options;

                        this.$element.on('touchstart.toLine.founder mousedown.toLine.founder', function(e) {
                                var ev = e.type == 'touchstart' ? e.originalEvent.touches[0] : e,
                                        that = this,
                                        startX=ev.pageX,
                                        startY=ev.pageY;

                                var $line=$('<div />', {
                                        "class": "ac-line"
                                }).appendTo(document.body).css({
                                        left: startX + 'px',
                                        top: startY + 'px'
                                });

                                if (options.before && $.isFunction(options.before)) {
                                        options.before.call(that, ev);
                                }

                                $(document).on('touchmove.toLine.founder mousemove.toLine.founder', function(e) {
                                        var ev = e.type == 'touchmove' ? e.originalEvent.touches[0] : e;

                                        var l = ev.pageX,
                                                t = ev.pageY,
                                                disX = l - startX,
                                                disY = t - startY,
                                                x = Math.abs(disX),
                                                y = Math.abs(disY);

                                        var dis = Math.round(Math.sqrt(x * x + y * y)),
                                                deg = Math.round(180 * Math.atan2(disY, disX) / Math.PI);

                                        $line.width(dis + 'px').css('transform', 'rotate(' + deg + 'deg)');

                                        if (options.process && $.isFunction(options.process)) {
                                                options.process.call(that, ev);
                                        }

                                        e.preventDefault();
                                });

                                $(document).on('touchend.toLine.founder mouseup.toLine.founder', function(e) {
                                        var ev = e.type == 'touchend' ? e.originalEvent.changedTouches[0] : e;

                                        if (options.end && $.isFunction(options.end)) {
                                                options.end.call(that, ev);
                                        }

                                        $(document).off('.toLine.founder');
                                });

                                e.preventDefault();
                        });
                }
        };

        //jQ插件模式
        $.fn.toLine = function(options) {
                return this.each(function() {
                        var $this = $(this),
                                instance = $this.data('toLine');

                        if (!instance) {
                                instance = new ToLine(this, options);
                                $this.data('toLine', instance);
                        } else {
                                instance.init();
                        }

                        if (typeof options === 'string') {
                                //instance.options[options].call(this);
                        }

                });
        };

        $.fn.toLine.defaults = {
                before: $.noop,
                process: $.noop,
                end: $.noop
        };

        $.fn.toLine.noConflict = function() {
                $.fn.toLine = old;
                return this;
        };
})(jQuery);

$('#div1').toLine({
                                before:function(){
                                        console.log('开始画直线啦~~');
                                },
                                process:function(){
                                        console.log('画直线ing~~');
                                },
                                end:function(){
                                        console.log('画完直线啦~~');
                                }
                        });

    $(document).ready(function(){
    	//$("div.sqr_block").html(window.screen.height + "  " + window.screen.width + "<br>" + $(window).width() + "<br>" + $(document).width());
    	//以16：10的22寸显示器（viewsonic vx2269wm 1680 × 1050）为标准 22 => 1981px 所以，1英寸对应90.05px
    	//标准显示器上的3英寸对应 1981×3/22 约270px
    	//不同尺寸的显示器3英寸对应的像素数为 window.screen.width * sqrt（356）*3 / (16 * M) 其中 M 为显示器尺寸
    	function getBlockWidth(screen_m){
    		return Math.round(window.screen.width * 3.5377 / screen_m);
    	}
    	screen_m = $("input#screen_size").val();;
    	x = getBlockWidth(screen_m);
    	console.log(Math.round(x));
    	$("div.sqr_block").css({"width":Math.round(x), "height":Math.round(x)})
    		.html(window.screen.width + "  " + window.screen.height + "<br>" + screen_m + "<br>" + Math.round(x) );
    	$("input#screen_size").change(function() {
    		screen_m = $("input#screen_size").val();;
    		x = getBlockWidth(screen_m);
    		$("div.sqr_block").css({"width":Math.round(x), "height":Math.round(x)})
    			.html(window.screen.width + "  " + window.screen.height + "<br>" + screen_m + "<br>" + Math.round(x) );
    	});

    	        // 圆  
        var $circle = null;  
  
        // 画布  
        var $drawing = $("#drawing");  
  
        // 圆心位置  
        var centerX = 0;  
        var centerY = 0;

        var topX, topY;
        var width, height;
  
        // 是否正在画圆  
        var isDrawing = false;  
  
        // 按下鼠标开始画圆  
        $drawing.mousedown(function(event) {  
            $circle = $('<div class="circle"></div>');  
            // centerX = event.pageX - $drawing.offset().left;  
            // centerY = event.pageY - $drawing.offset().top; 
            topX = event.pageX - $drawing.offset().left;
            topY = event.pageY - $drawing.offset().top; 
            $(this).append($circle);  
            isDrawing = true;  
            event.preventDefault();  
        });  
  
        // 鼠标拖动  
        $(document).mousemove(function(event) {  
            if(isDrawing) {
                var newX = event.pageX - $drawing.offset().left;
                var newY = event.pageY - $drawing.offset().top;
                var circleX = 0;
                var circleY = 0;

                if(newX < 0 ){
                    newX = 0;
                }else if (newX > $drawing.width()){
                    newX = $drawing.width();
                }
                if(newY < 0){
                    newY = 0;
                }else if (newY > $drawing.height()){
                    newY = $drawing.height();
                }

                                console.log(newX, newY);
                console.log($drawing.offset().left , $drawing.width());

                width = Math.abs(newX - topX);
                height = Math.abs(newY - topY);

                if (width > height){
                    width = height;
                }else{
                    height = width;
                }

                if(newX < topX){
                    circleX = topX - width;
                }else{
                    circleX = topX;
                }

                if(newY < topY){
                    circleY = topY - height;
                }else{
                    circleY = topY;
                }

                var radius = Math.sqrt(width * width + height * height) /2; // 半径，勾股定理  
  
                // 设置圆的大小和位置  
                $circle.css("left", circleX + "px");  
                $circle.css("top", circleY + "px");  
                $circle.css("width", width + "px");  
                $circle.css("height", height + "px");  
                $circle.css("border-radius", radius + "px");
                $circle.css("line-height", height + "px");
                $circle.html('测试!');
            }  
        });  
  
        // 鼠标松开停止画圆  
        $(document).mouseup(function() {  
            isDrawing = false;  
        });  

    });
    </script>
  </body>
</html>  